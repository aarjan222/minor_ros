<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="car">

    <xacro:include filename="inertial_macros.xacro" />
    <xacro:macro name="carlikebot" params="prefix">

        <material name="invisible">
            <color rgba="0.0 0.0 0.0 0.0" />
        </material>

        <material name="white">
            <color rgba="1 1 1 1" />
        </material>

        <material name="orange">
            <color rgba="1 0.3 0.1 1" />
        </material>

        <material name="blue">
            <color rgba="0.2 0.2 1 1" />
        </material>

        <material name="black">
            <color rgba="0 0 0 1" />
        </material>

        <material name="red">
            <color rgba="1 0 0 1" />
        </material>

        <!-- Constants for robot dimensions -->
        <xacro:property name="PI" value="3.1415926535897931" />
        <xacro:property name="base_mass" value="8.0" /> <!-- arbitrary value for base mass -->
        <xacro:property name="base_length" value="1.0" />
        <xacro:property name="base_width" value="0.55" />
        <xacro:property name="base_height" value="0.45" />
        <xacro:property name="wheel_mass" value="0.1" /> <!-- arbitrary value for wheel mass -->
        <xacro:property name="wheelbase" value="0.54" />
        <xacro:property name="wheel_len" value="0.08" />
        <xacro:property name="wheel_radius" value="0.115" />
        <!-- <xacro:property name="wheeltrack" value="" -->

        <!-- Base Link -->
        <link name="${prefix}base_link">
        </link>
        <inertial>
            <mass value="0.01" />
            <inertia ixx="1.0" ixy="0.0" ixz="0.0" iyy="1.0" iyz="0.0" izz="1.0" />
        </inertial>

        <joint name="${prefix}base_joint" type="fixed">
            <parent link="${prefix}base_link" />
            <child link="${prefix}base_footprint" />
            <origin xyz="0 0 -0.1" />
        </joint>

        <!-- Base Footprint -->
        <link name="${prefix}base_footprint">
        </link>
        <inertial>
            <mass value="0.01" />
            <inertia ixx="1.0" ixy="0.0" ixz="0.0" iyy="1.0" iyz="0.0" izz="1.0" />
        </inertial>

        <!-- Chassis -->
        <joint name="${prefix}chassis_joint" type="fixed">
            <parent link="${prefix}base_link"></parent>
            <child link="${prefix}chassis_link"></child>
        </joint>

        <link name="${prefix}chassis_link">
            <visual>
                <origin xyz="0.5 0 0.25" />
                <geometry>
                    <box size="1 0.55 0.45" />
                </geometry>
                <material name="red" />
            </visual>
            <collision>
                <origin xyz="0.5 0 0.25" />
                <geometry>
                    <box size="1 0.55 0.45" />
                </geometry>
            </collision>
            <xacro:inertial_box mass="8" x="1" y="0.55" z="0.45">
                <origin xyz="0.5 0 0.25" rpy="0 0 0" />
            </xacro:inertial_box>
        </link>

        <!-- rear wheels -->

        <!-- virtual rear wheel -->

        <joint name="${prefix}virtual_rear_wheel_joint" type="continuous">
            <parent link="${prefix}base_link" />
            <child link="${prefix}virtual_rear_wheel" />
            <origin xyz="0.22 0 0" rpy="${pi/2} 0 0" />
            <axis xyz="0 0 -1" />
            <limit effort="100.0" velocity="100.0" />
            <dynamics damping="0.2" />
        </joint>

        <link name="${prefix}virtual_rear_wheel">
            <visual>
                <!-- <origin xyz="0 0 0" rpy="${PI/2} 0 ${PI/2}" /> -->
                <geometry>
                    <cylinder length="0.01" radius="${wheel_radius}" />
                </geometry>
                <material name="invisible" />
            </visual>
        </link>


        <!-- rear right wheel -->
        <joint
            name="${prefix}rear_right_wheel_joint" type="continuous">
            <parent link="${prefix}base_link" />
            <child link="${prefix}rear_right_wheel" />
            <origin xyz="0.22 -0.275 0" rpy="${pi/2} 0 0" />
            <axis xyz="0 0 -1 " />
            <limit effort="100.0" velocity="100.0" />
            <dynamics damping="0.2" />
            <mimic joint="${prefix}virtual_rear_wheel_joint" multiplier="1.0" offset="0.0" />
        </joint>

        <link
            name="${prefix}rear_right_wheel">
            <visual>
                <geometry>
                    <cylinder length="0.08" radius="0.115" />
                </geometry>
                <material name="black" />
            </visual>

            <collision>
                <geometry>
                    <cylinder length="0.08" radius="0.115" />
                </geometry>
            </collision>

            <xacro:inertial_cylinder mass="0.8" length="0.06" radius="0.04">
                <origin xyz="0 0 0" rpy="0 0 0" />
            </xacro:inertial_cylinder>
        </link>

        <!-- rear left wheel -->
        <joint
            name="${prefix}rear_left_wheel_joint" type="continuous">
            <parent link="${prefix}base_link" />
            <child link="${prefix}rear_left_wheel" />
            <origin xyz="0.22 0.275 0" rpy="-${pi/2} 0 0" />
            <axis xyz="0 0 1" />
            <limit effort="100.0" velocity="100.0" />
            <dynamics damping="0.2" />
            <mimic joint="${prefix}virtual_rear_wheel_joint" multiplier="1.0" offset="0.0" />
        </joint>

        <link
            name="${prefix}rear_left_wheel">
            <visual>
                <geometry>
                    <cylinder length="0.08" radius="0.115" />
                </geometry>
                <material name="black" />
            </visual>

            <collision>
                <geometry>
                    <cylinder length="0.08" radius="0.115" />
                </geometry>
            </collision>

            <xacro:inertial_cylinder mass="0.8" length="0.06" radius="0.04">
                <origin xyz="0 0 0" rpy="0 0 0" />
            </xacro:inertial_cylinder>
        </link>

        <!-- front wheels -->

        <!-- virtual front wheel -->
        <joint name="${prefix}virtual_front_wheel_joint" type="revolute">
            <parent link="${prefix}base_link" />
            <child link="${prefix}virtual_front_wheel" />
            <origin xyz="0.75 0 0" rpy="-${pi/2} 0 0" />
            <axis xyz="0 0 1" />
            <limit lower="-0.4" upper="0.4" effort="100.0" velocity="0.0" />
            <dynamics damping="0.2" />
        </joint>

        <link name="${prefix}virtual_front_wheel">
            <visual>
                <geometry>
                    <cylinder length="0.01" radius="${wheel_radius}" />
                </geometry>
                <material name="invisible" />
            </visual>
        </link>


        <!-- front right wheel -->
        <joint name="${prefix}front_right_wheel_joint" type="revolute">
            <parent link="${prefix}base_link" />
            <child link="${prefix}front_right_wheel" />
            <origin xyz="0.75 0.275 0" rpy="-${pi/2} 0 0" />
            <axis xyz="0 0 1" />
            <limit lower="-0.4" upper="0.4" effort="100.0" velocity="0.0" />
            <dynamics damping="0.2" />
            <mimic joint="${prefix}virtual_front_wheel_joint" multiplier="1.0" offset="0.0" />
        </joint>

        <link
            name="${prefix}front_right_wheel">
            <visual>
                <geometry>
                    <cylinder length="0.08" radius="0.115" />
                </geometry>
                <material name="black" />
            </visual>

            <collision>
                <geometry>
                    <cylinder length="0.08" radius="0.115" />
                </geometry>
            </collision>

            <xacro:inertial_cylinder mass="0.8" length="0.06" radius="0.04">
                <origin xyz="0 0 0" rpy="0 0 0" />
            </xacro:inertial_cylinder>
        </link>

        <!-- front left wheel -->
        <joint name="${prefix}front_left_wheel_joint" type="revolute">
            <parent link="${prefix}base_link" />
            <child link="${prefix}front_left_wheel" />
            <origin xyz="0.75 -0.275 0" rpy="-${pi/2} 0 0" />
            <axis xyz="0 0 1" />
            <limit lower="-0.4" upper="0.4" effort="100.0" velocity="0.0" />
            <dynamics damping="0.2" />
            <mimic joint="${prefix}virtual_front_wheel_joint" multiplier="1.0" offset="0.0" />
        </joint>

        <link
            name="${prefix}front_left_wheel">
            <visual>
                <geometry>
                    <cylinder length="0.08" radius="0.115" />
                </geometry>
                <material name="black" />
            </visual>

            <collision>
                <geometry>
                    <cylinder length="0.08" radius="0.115" />
                </geometry>
            </collision>

            <xacro:inertial_cylinder mass="0.8" length="0.08" radius="0.115">
                <origin xyz="0 0 0" rpy="0 0 0" />
            </xacro:inertial_cylinder>
        </link>

    </xacro:macro>
</robot>